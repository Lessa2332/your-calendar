<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Calendar Puzzle | –ö–∞–ª–µ–Ω–¥–∞—Ä AR –ü–∞–∑–ª–∏</title>
   
    <!-- üî• –°—É–º—ñ—Å–Ω—ñ –≤–µ—Ä—Å—ñ—ó: A-Frame 1.4.0 + MindAR 1.2.3 -->
    <script defer src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
   
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
        }
        .language-switcher {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255,255,255,0.95); padding: 10px 15px;
            border-radius: 20px; z-index: 100; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 2px solid #ff9e7d; display: flex; gap: 10px;
        }
        .lang-btn {
            background: none; border: none; padding: 8px 15px; cursor: pointer;
            border-radius: 15px; transition: all 0.3s; font-family: inherit; font-weight: bold;
        }
        .lang-btn.active { background: #4ecdc4; color: white; }
        #ar-container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        #ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        #instructions, #completion-message {
            background-color: rgba(255,255,255,0.95); border-radius: 20px; padding: 25px;
            text-align: center; max-width: 400px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            pointer-events: auto; border: 4px solid #ff9e7d; margin: 15px;
        }
        #instructions h2, #completion-message h2 {
            color: #ff6b6b; margin-bottom: 15px; font-size: 28px;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
        }
        #instructions p, #completion-message p {
            margin-bottom: 20px; color: #333; line-height: 1.5; font-size: 18px;
        }
        button {
            background: linear-gradient(to bottom, #4ecdc4, #44a08d); color: white;
            border: none; padding: 12px 25px; border-radius: 30px; font-size: 18px;
            cursor: pointer; transition: all 0.3s; font-family: inherit; pointer-events: auto;
            box-shadow: 0 4px 0 #2a7c74; font-weight: bold; margin: 5px;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 0 #2a7c74; }
        button:active { transform: translateY(1px); box-shadow: 0 2px 0 #2a7c74; }
        .hidden { display: none !important; }
        .puzzle-counter {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.9); padding: 10px 15px; border-radius: 20px;
            font-weight: bold; color: #ff6b6b; pointer-events: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); border: 2px solid #ff9e7d; z-index: 100;
        }
        .marker-hint {
            position: absolute; bottom: 20px; left: 0; right: 0; text-align: center;
            color: white; font-size: 16px; pointer-events: none;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
            background: rgba(0,0,0,0.4); padding: 10px; border-radius: 10px; margin: 0 20px;
            z-index: 100;
        }
        @keyframes star-pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .star-particle { animation: star-pulse 1s infinite; }
        #loading-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; color: white;
        }
        .loader {
            width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid white; border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .processing-info {
            position: absolute; bottom: 80px; left: 0; right: 0; text-align: center;
            color: white; font-size: 14px; pointer-events: none;
            background: rgba(0,0,0,0.6); padding: 8px; margin: 0 20px;
            border-radius: 10px; z-index: 100;
        }
        @media (max-width: 768px) {
            #instructions, #completion-message { margin: 10px; padding: 20px; }
            #instructions h2, #completion-message h2 { font-size: 24px; }
            #instructions p, #completion-message p { font-size: 16px; }
            button { padding: 10px 20px; font-size: 16px; }
            .language-switcher { top: 10px; left: 10px; padding: 8px 12px; }
            .puzzle-counter { top: 10px; right: 10px; }
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loader"></div>
        <h2 data-i18n="loading.title">Loading AR Experience...</h2>
        <p data-i18n="loading.description">Preparing for your puzzle adventure</p>
        <div class="processing-info" id="processing-info">Initializing AR...</div>
    </div>
    <div class="language-switcher">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="uk">UA</button>
    </div>
    <!-- üî• –ü–û–†–û–ñ–ù–Ü–ô –ö–û–ù–¢–ï–ô–ù–ï–† ‚Äî —Å—Ü–µ–Ω—É —Å—Ç–≤–æ—Ä–∏–º–æ —á–µ—Ä–µ–∑ JS -->
    <div id="ar-container"></div>
    <div id="ui-overlay">
        <div id="instructions">
            <h2 data-i18n="instructions.title">AR Calendar Puzzle Adventure! üß©</h2>
            <p data-i18n="instructions.description1">Point your device at any calendar image to reveal a puzzle!</p>
            <p data-i18n="instructions.description2">Drag the pieces to the board to complete it and see magic! ‚ú®</p>
            <button id="start-btn" data-i18n="instructions.startButton">Start AR Experience</button>
        </div>
        <div id="completion-message" class="hidden">
            <h2 data-i18n="completion.title">Congratulations! üéâ</h2>
            <p data-i18n="completion.description">You completed the puzzle! Amazing!</p>
            <button id="continue-btn" data-i18n="completion.continueButton">Try Another Image</button>
        </div>
    </div>
    <div class="puzzle-counter">
        <span data-i18n="counter.text">Pieces:</span> <span id="piece-count">0</span>/9
    </div>
    <div class="marker-hint" data-i18n="marker.hint">
        Point camera at any calendar image to start a puzzle
    </div>
    <canvas id="image-processor" style="display: none;"></canvas>
    <script>
        const translations = {
            en: {
                "loading.title": "Loading AR Experience...",
                "loading.description": "Preparing for your puzzle adventure",
                "instructions.title": "AR Calendar Puzzle Adventure! üß©",
                "instructions.description1": "Point your device at any calendar image to reveal a puzzle!",
                "instructions.description2": "Drag the pieces to the board to complete it and see magic! ‚ú®",
                "instructions.startButton": "Start AR Experience",
                "completion.title": "Congratulations! üéâ",
                "completion.description": "You completed the puzzle! Amazing!",
                "completion.continueButton": "Try Another Image",
                "counter.text": "Pieces:",
                "marker.hint": "Point camera at any calendar image to start a puzzle"
            },
            uk: {
                "loading.title": "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AR...",
                "loading.description": "–ì–æ—Ç—É—î–º–æ –ø—Ä–∏–≥–æ–¥—É –∑ –ø–∞–∑–ª–∞–º–∏",
                "instructions.title": "AR –ö–∞–ª–µ–Ω–¥–∞—Ä –ü–∞–∑–ª–∏! üß©",
                "instructions.description1": "–ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏—Å—Ç—Ä—ñ–π –Ω–∞ –±—É–¥—å-—è–∫–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–∞–∑–ª!",
                "instructions.description2": "–ü–µ—Ä–µ—Ç—è–≥—É–π—Ç–µ –ø–∞–∑–ª–∏ –Ω–∞ –¥–æ—à–∫—É, —â–æ–± —Å–∫–ª–∞—Å—Ç–∏ –π–æ–≥–æ —Ç–∞ –ø–æ–±–∞—á–∏—Ç–∏ –º–∞–≥—ñ—é! ‚ú®",
                "instructions.startButton": "–ü–æ—á–∞—Ç–∏ AR –ì—Ä—É",
                "completion.title": "–í—ñ—Ç–∞—î–º–æ! üéâ",
                "completion.description": "–í–∏ —Å–∫–ª–∞–ª–∏ –ø–∞–∑–ª! –ß—É–¥–æ–≤–æ!",
                "completion.continueButton": "–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ–Ω—à–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è",
                "counter.text": "–ü–∞–∑–ª—ñ–≤:",
                "marker.hint": "–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –±—É–¥—å-—è–∫–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è, —â–æ–± –ø–æ—á–∞—Ç–∏"
            }
        };
        class ImageSplitter {
            constructor() {
                this.canvas = document.getElementById('image-processor');
                this.ctx = this.canvas.getContext('2d');
            }
            async splitImage(imageUrl, rows = 3, cols = 3) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = "anonymous";
                    img.onload = () => {
                        try {
                            const w = img.width / cols, h = img.height / rows;
                            const pieces = [];
                            this.canvas.width = w; this.canvas.height = h;
                            for (let r = 0; r < rows; r++) {
                                for (let c = 0; c < cols; c++) {
                                    this.ctx.clearRect(0, 0, w, h);
                                    this.ctx.drawImage(img, c * w, r * h, w, h, 0, 0, w, h);
                                    pieces.push({
                                        dataURL: this.canvas.toDataURL('image/jpeg', 0.92),
                                        row: r, col: c, index: r * cols + c
                                    });
                                }
                            }
                            resolve(pieces);
                        } catch (e) { reject(e); }
                    };
                    img.onerror = () => reject(new Error('Image load failed'));
                    img.src = imageUrl;
                });
            }
        }
        class ARPuzzleGame {
            constructor() {
                this.scene = document.querySelector('a-scene');
                this.isDragging = false;
                this.currentPiece = null;
                this.placedPieces = [];
                this.gridSize = 3;
                this.gridSlots = [];
                this.puzzleCompleted = false;
                this.currentTargetIndex = null;
                this.imageSplitter = new ImageSplitter();
                this.numTargets = 12; // –ö—ñ–ª—å–∫—ñ—Å—Ç—å targets –∑ calendar.mind ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ñ MindAR
                this.init();
            }
            async init() {
                this.setupLocalization();
                this.setupEventListeners();
                this.setupDragAndDrop();
                this.scene.addEventListener('loaded', () => {
                    console.log('A-Frame scene loaded');
                    const mindarSystem = this.scene.systems['mindar-image-system'];
                    if (!mindarSystem) {
                        console.error('MindAR system not initialized');
                        document.getElementById('processing-info').textContent = "‚ùå AR failed to initialize. Check console.";
                        return;
                    }
                    console.log('MindAR ready, targets:', this.numTargets);
                    this.createTargetContainers();
                    this.createGrid();
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('processing-info').textContent = "‚úÖ AR Ready! Tap Start & Allow Camera";
                });
                this.scene.addEventListener('mindar-image-targetFound', (e) => {
                    console.log('Target found:', e.detail.index);
                    this.onTargetFound(e.detail.index);
                });
                this.scene.addEventListener('mindar-image-targetLost', (e) => {
                    console.log('Target lost:', e.detail.index);
                });
                // –î–æ–¥–∞–Ω–æ: –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ AR
                this.scene.addEventListener('arError', (e) => {
                    console.error('AR Error:', e.detail);
                    document.getElementById('processing-info').textContent = "‚ùå AR Error: " + (e.detail || 'Camera failed. Check permissions.');
                });
                // –î–æ–¥–∞–Ω–æ: –ê–≤—Ç–æ-start –ø—ñ—Å–ª—è loaded (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ç–µ—Å—Ç—ñ–≤ ‚Äî —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ)
                // setTimeout(() => this.autoStartAR(), 2000);
            }
            autoStartAR() { // –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –¥–ª—è –∞–≤—Ç–æ-—Å—Ç–∞—Ä—Ç—É
                const mindarSystem = this.scene.systems['mindar-image-system'];
                if (mindarSystem && typeof mindarSystem.start === 'function') {
                    mindarSystem.start();
                    document.getElementById('instructions').classList.add('hidden');
                    document.getElementById('puzzle-board').setAttribute('visible', 'true');
                    this.gridSlots.forEach(slot => slot.element.setAttribute('visible', 'true'));
                }
            }
            createTargetContainers() {
                const container = document.getElementById('puzzle-targets-container');
                for (let i = 0; i < this.numTargets; i++) { // –û–±–º–µ–∂–µ–Ω–æ numTargets
                    const target = document.createElement('a-entity');
                    target.setAttribute('mindar-image-target', `targetIndex: ${i}`);
                    const puzzleContainer = document.createElement('a-entity');
                    puzzleContainer.setAttribute('id', `puzzle-container-${i}`);
                    target.appendChild(puzzleContainer);
                    container.appendChild(target);
                }
                console.log(`Created ${this.numTargets} target containers`);
            }
            createGrid() {
                const gridContainer = document.getElementById('grid-container');
                const size = 0.8;
                for (let r = 0; r < 3; r++) {
                    for (let c = 0; c < 3; c++) {
                        const x = (c - 1) * size;
                        const y = (1 - r) * size;
                        const slot = document.createElement('a-entity');
                        slot.setAttribute('position', `${x} ${y} 0.01`);
                        slot.setAttribute('geometry', `primitive: plane; width: ${size * 0.85}; height: ${size * 0.85}`);
                        slot.setAttribute('material', 'color: rgb(200, 200, 200); transparent: true; opacity: 0.3');
                        slot.setAttribute('visible', 'false');
                        gridContainer.appendChild(slot);
                        this.gridSlots.push({ element: slot, row: r, col: c, occupied: false });
                    }
                }
            }
            setupLocalization() {
                this.currentLang = 'en';
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const lang = e.target.dataset.lang;
                        this.switchLanguage(lang);
                        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                    });
                });
                this.loadLanguage('en');
            }
            switchLanguage(lang) {
                this.currentLang = lang;
                this.loadLanguage(lang);
            }
            loadLanguage(lang) {
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang]?.[key]) el.textContent = translations[lang][key];
                });
            }
            setupEventListeners() {
                document.getElementById('start-btn').addEventListener('click', () => {
                    console.log('Start button clicked');
                    document.getElementById('instructions').classList.add('hidden');
                    document.getElementById('puzzle-board').setAttribute('visible', 'true');
                    this.gridSlots.forEach(slot => slot.element.setAttribute('visible', 'true'));
                    const mindarSystem = this.scene.systems['mindar-image-system'];  // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: systems['mindar-image-system']
                    if (mindarSystem && typeof mindarSystem.start === 'function') {
                        console.log('Starting MindAR...');
                        // –î–æ–¥–∞–Ω–æ –∑–∞—Ç—Ä–∏–º–∫—É –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó object3D
                        setTimeout(() => {
                            mindarSystem.start();
                            document.getElementById('processing-info').textContent = "üì± Allow camera & point at calendar (one of 12 trained images)";
                        }, 500);
                    } else {
                        console.error('MindAR start failed');
                        document.getElementById('processing-info').textContent = "‚ùå MindAR start failed. Reload page.";
                    }
                });
                document.getElementById('continue-btn').addEventListener('click', () => {
                    this.resetPuzzle();
                    document.getElementById('completion-message').classList.add('hidden');
                });
            }
            async onTargetFound(targetIndex) {
                if (targetIndex >= this.numTargets) {
                    console.warn('Invalid target index:', targetIndex);
                    return;
                }
                console.log('Processing target:', targetIndex);
                if (this.puzzleCompleted && this.currentTargetIndex === targetIndex) return;
                if (this.currentTargetIndex !== null && this.currentTargetIndex !== targetIndex) {
                    this.resetPuzzle();
                }
                this.currentTargetIndex = targetIndex;
                await this.loadAndShowPuzzle(targetIndex);
            }
            async loadAndShowPuzzle(targetIndex) {
                const url = `https://cdn.jsdelivr.net/gh/lessa2332/your-calendar/images/${String(targetIndex + 1).padStart(2, '0')}.jpg`;
                const container = document.getElementById(`puzzle-container-${targetIndex}`);
                while (container.firstChild) container.removeChild(container.firstChild);
                try {
                    document.getElementById('processing-info').textContent = "üîÑ Loading puzzle...";
                    console.log('Loading image:', url);
                    const pieces = await this.imageSplitter.splitImage(url, 3, 3);
                    pieces.forEach((piece, idx) => {
                        const angle = (idx / 9) * Math.PI * 2;
                        const radius = 0.6 + (idx % 3) * 0.1;
                        const y = -0.2 + Math.floor(idx / 3) * 0.25;
                        const pieceEl = document.createElement('a-entity');
                        pieceEl.setAttribute('class', 'puzzle-piece');
                        pieceEl.setAttribute('data-piece-id', idx);
                        pieceEl.setAttribute('data-correct-row', piece.row);
                        pieceEl.setAttribute('data-correct-col', piece.col);
                        pieceEl.setAttribute('data-target-index', targetIndex);
                        pieceEl.setAttribute('position', `${Math.cos(angle) * radius} ${y} ${Math.sin(angle) * radius + 0.2}`);
                        pieceEl.setAttribute('scale', '0.28 0.28 0.28');
                        const plane = document.createElement('a-plane');
                        plane.setAttribute('width', '0.55'); plane.setAttribute('height', '0.55');
                        plane.setAttribute('src', piece.dataURL); plane.setAttribute('transparent', 'true');
                        pieceEl.appendChild(plane);
                        container.appendChild(pieceEl);
                    });
                    document.getElementById('processing-info').textContent = "‚úÖ Drag pieces to board! üéÆ";
                    console.log('Puzzle loaded for target:', targetIndex);
                } catch (err) {
                    console.error("Puzzle load error:", err);
                    document.getElementById('processing-info').textContent = `‚ö†Ô∏è Failed to load image ${targetIndex + 1}. Check repo.`;
                }
            }
            setupDragAndDrop() {
                const events = ['mousedown', 'touchstart', 'mousemove', 'touchmove', 'mouseup', 'touchend'];
                events.forEach(type => {
                    this.scene.addEventListener(type, (e) => {
                        if (type === 'mousedown' || type === 'touchstart') this.onInteractionStart(e);
                        if (type === 'mousemove' || type === 'touchmove') this.onInteractionMove(e);
                        if (type === 'mouseup' || type === 'touchend') this.onInteractionEnd(e);
                    });
                });
            }
            onInteractionStart(e) {
                if (this.puzzleCompleted) return;
                const el = e.detail?.intersectedEl;
                if (!el) return;
                let piece = el.classList.contains('puzzle-piece') ? el : el.parentElement;
                if (!piece || !piece.classList.contains('puzzle-piece')) return;
                if (parseInt(piece.getAttribute('data-target-index')) !== this.currentTargetIndex) return;
                this.isDragging = true;
                this.currentPiece = piece;
                this.currentPiece.setAttribute('scale', '0.32 0.32 0.32');
                console.log('Dragging piece:', piece.getAttribute('data-piece-id'));
                e.preventDefault();
            }
            onInteractionMove(e) {
                if (!this.isDragging || !this.currentPiece) return;
                const cam = this.scene.querySelector('[camera]');
                const pos = cam.getAttribute('position');
                this.currentPiece.setAttribute('position', {
                    x: pos.x + (Math.random() - 0.5) * 0.2,
                    y: pos.y + (Math.random() - 0.5) * 0.2,
                    z: pos.z - 0.6
                });
                e.preventDefault();
            }
            onInteractionEnd(e) {
                if (!this.isDragging || !this.currentPiece) return;
                this.isDragging = false;
                this.snapToGrid(this.currentPiece);
                this.currentPiece = null;
                e.preventDefault();
            }
            snapToGrid(piece) {
                const r = parseInt(piece.getAttribute('data-correct-row'));
                const c = parseInt(piece.getAttribute('data-correct-col'));
                const slot = this.gridSlots.find(s => s.row === r && s.col === c);
                if (slot && !slot.occupied) {
                    const board = document.getElementById('puzzle-board').getAttribute('position');
                    const sPos = slot.element.getAttribute('position');
                    const target = { x: board.x + sPos.x, y: board.y + sPos.y, z: board.z + 0.02 };
                    piece.setAttribute('position', target);
                    piece.setAttribute('scale', '0.25 0.25 0.25');
                    slot.occupied = true;
                    this.placedPieces.push(piece.getAttribute('data-piece-id'));
                    document.getElementById('piece-count').textContent = this.placedPieces.length;
                    console.log('Piece placed:', this.placedPieces.length, '/9');
                    if (this.placedPieces.length === 9) this.showVictoryAnimation();
                } else {
                    piece.setAttribute('scale', '0.28 0.28 0.28');
                }
            }
            showVictoryAnimation() {
                this.puzzleCompleted = true;
                const fx = document.getElementById('victory-effects');
                fx.setAttribute('visible', 'true');
                for (let i = 0; i < 15; i++) {
                    const star = document.createElement('a-entity');
                    star.setAttribute('geometry', 'primitive: octahedron');
                    star.setAttribute('material', 'color: yellow; shader: flat');
                    star.setAttribute('scale', '0.1 0.1 0.1');
                    const a = Math.random() * Math.PI * 2;
                    const r = 0.3 + Math.random() * 0.7;
                    const y = -0.5 + Math.random() * 1;
                    star.setAttribute('position', { x: Math.cos(a) * r, y, z: Math.sin(a) * r - 1.5 });
                    star.setAttribute('animation', {
                        property: 'position',
                        to: `${Math.cos(a)*2} ${y+1.5} ${Math.sin(a)*2 - 1.5}`,
                        dur: 2000 + Math.random() * 1000,
                        easing: 'easeOutQuad'
                    });
                    fx.appendChild(star);
                }
                document.getElementById('completion-message').classList.remove('hidden');
                document.getElementById('processing-info').textContent = "üéâ Completed! Try another.";
            }
            resetPuzzle() {
                console.log('Resetting puzzle');
                document.getElementById('puzzle-board').setAttribute('visible', 'false');
                document.getElementById('victory-effects').setAttribute('visible', 'false');
                while (document.getElementById('victory-effects').firstChild) {
                    document.getElementById('victory-effects').removeChild(document.getElementById('victory-effects').firstChild);
                }
                for (let i = 0; i < this.numTargets; i++) {
                    const cont = document.getElementById(`puzzle-container-${i}`);
                    if (cont) while (cont.firstChild) cont.removeChild(cont.firstChild);
                }
                this.placedPieces = [];
                this.puzzleCompleted = false;
                this.currentTargetIndex = null;
                document.getElementById('piece-count').textContent = '0';
                this.gridSlots.forEach(slot => {
                    slot.occupied = false;
                    slot.element.setAttribute('visible', 'false');
                });
                document.getElementById('processing-info').textContent = "üîç Point at one of 12 trained calendar images";
                const mindarSystem = this.scene.systems['mindar-image-system'];  // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: systems['mindar-image-system']
                if (mindarSystem && typeof mindarSystem.stop === 'function') {
                    mindarSystem.stop();  // –ó—É–ø–∏–Ω–∏—Ç–∏ AR –¥–ª—è reset
                }
            }
        }
        // üî• –ö–†–ò–¢–ò–ß–ù–û: —Å—Ç–≤–æ—Ä—é—î–º–æ —Å—Ü–µ–Ω—É –ª–∏—à–µ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è A-Frame —ñ MindAR
        function initARScene() {
            if (typeof AFRAME === 'undefined' || !AFRAME.systems['mindar-image-system']) {
                setTimeout(initARScene, 100);
                return;
            }
            // –°—Ç–≤–æ—Ä—é—î–º–æ <a-scene>
            const scene = document.createElement('a-scene');
            scene.setAttribute('mindar-image', 'imageTargetSrc: https://cdn.jsdelivr.net/gh/lessa2332/your-calendar/calendar.mind; autoStart: false; uiLoading: yes; uiScanning: yes; uiError: yes; filterMinCF: 0.01; filterBeta: 1000;'); // –î–æ–¥–∞–Ω–æ UI –¥–ª—è –ø–æ–º–∏–ª–æ–∫/–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            scene.setAttribute('color-space', 'sRGB');
            scene.setAttribute('renderer', 'antialias: true, colorManagement: true, physicallyCorrectLights: true'); // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–¥–∞–Ω–æ colorManagement —Ç–∞ physicallyCorrectLights
            scene.setAttribute('vr-mode-ui', 'enabled: false');
            scene.setAttribute('device-orientation-permission-ui', 'enabled: false');
            // –í–∏–¥–∞–ª–µ–Ω–æ 'embedded': '' ‚Äî –º–æ–∂–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É–≤–∞—Ç–∏ –∑ AR –∫–∞–º–µ—Ä–æ—é
            // –ö–∞–º–µ—Ä–∞
            const camera = document.createElement('a-entity');
            camera.setAttribute('camera', '');
            scene.appendChild(camera);
            // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
            const puzzleTargets = document.createElement('a-entity');
            puzzleTargets.id = 'puzzle-targets-container';
            scene.appendChild(puzzleTargets);
            const puzzleBoard = document.createElement('a-entity');
            puzzleBoard.id = 'puzzle-board';
            puzzleBoard.setAttribute('position', '0 0 -1.5');
            puzzleBoard.setAttribute('visible', 'false');
            const boardPlane = document.createElement('a-plane');
            boardPlane.id = 'board';
            boardPlane.setAttribute('color', '#f0f0f0');
            boardPlane.setAttribute('width', '2.5');
            boardPlane.setAttribute('height', '2.5');
            boardPlane.setAttribute('position', '0 0 0');
            puzzleBoard.appendChild(boardPlane);
            const gridContainer = document.createElement('a-entity');
            gridContainer.id = 'grid-container';
            puzzleBoard.appendChild(gridContainer);
            scene.appendChild(puzzleBoard);
            const victoryEffects = document.createElement('a-entity');
            victoryEffects.id = 'victory-effects';
            victoryEffects.setAttribute('visible', 'false');
            scene.appendChild(victoryEffects);
            // –î–æ–¥–∞—î–º–æ —Å—Ü–µ–Ω—É –≤ DOM
            document.getElementById('ar-container').appendChild(scene);
            // –¢–µ–ø–µ—Ä —Å—Ç–∞—Ä—Ç—É—î–º–æ –≥—Ä—É
            window.puzzleGame = new ARPuzzleGame();
        }
        // –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø—ñ—Å–ª—è DOM –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initARScene);
        } else {
            initARScene();
        }
    </script>
</body>
</html>
