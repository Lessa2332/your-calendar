<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Magical Ukraine Calendar 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    #mindar-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 100;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    #info {
      text-align: center;
      color: white;
      text-shadow: 0 0 10px #00ffff;
      padding: 10px 16px;
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      font-size: clamp(14px, 4vw, 18px);
      line-height: 1.4;
      max-width: 90%;
      margin: 0 auto;
      pointer-events: none;
    }
    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      gap: 10px;
      pointer-events: auto;
    }
    .lang-btn, .etsy-btn {
      pointer-events: auto;
      background: rgba(0, 200, 255, 0.2);
      border: 1px solid #00ffff;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: background 0.2s ease;
    }
    .lang-btn:hover, .etsy-btn:hover {
      background: rgba(0, 200, 255, 0.4);
    }
    #crystals {
      display: flex;
      gap: clamp(8px, 3vw, 14px);
      justify-content: center;
      padding: 0 8px 20px;
      pointer-events: none;
      flex-wrap: wrap;
    }
    .crystal-slot {
      width: clamp(40px, 12vw, 56px);
      height: clamp(40px, 12vw, 56px);
      border: 2px solid #00ffff77;
      border-radius: 50%;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(24px, 7vw, 36px);
      font-weight: bold;
      color: white;
      transition: all 0.3s ease;
    }
    .crystal-slot.collected {
      background: linear-gradient(45deg, #00ffff, #ff00ff);
      transform: scale(1.1);
      box-shadow: 0 0 10px #00ffff;
    }
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #00ffff;
      font-size: 18px;
      z-index: 101;
      display: none;
      text-align: center;
    }
    .spinner {
      border: 4px solid rgba(0, 255, 255, 0.3);
      border-top: 4px solid #00ffff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Error fallback */
    #error-fallback {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
      padding: 20px;
      max-width: 90%;
      z-index: 102;
      display: none;
    }
    #error-fallback h3 {
      color: #00ffff;
      margin-bottom: 15px;
      font-size: 20px;
    }
    #error-fallback p {
      margin: 10px 0;
      line-height: 1.5;
    }
    .retry-btn {
      background: rgba(0, 200, 255, 0.3);
      border: 1px solid #00ffff;
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
    }
    /* Touch feedback animation */
    .touch-feedback {
      position: absolute;
      border: 3px solid #00ffff;
      border-radius: 50%;
      animation: ripple 0.6s ease-out;
      pointer-events: none;
      z-index: 99;
    }
    @keyframes ripple {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(3); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="loading">
    <div class="spinner"></div>
    <div id="loading-text">Loading AR Experience...</div>
  </div>

  <div id="error-fallback">
    <h3>ü™Ñ –ö–∞–º–µ—Ä–∞ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–ª—è –º–∞–≥—ñ—ó!</h3>
    <p>–ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø—Ä–∏—Å—Ç—Ä—ñ–π —ñ–∑ –∑–∞–¥–Ω—å–æ—é –∫–∞–º–µ—Ä–æ—é.</p>
    <p><strong>–ü–æ—Ä–∞–¥–∞:</strong> –†–æ–∑–¥—Ä—É–∫—É–π—Ç–µ –º–∞—Ä–∫–µ—Ä–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Ç–∞ –Ω–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –Ω–∏—Ö!</p>
    <button class="retry-btn" id="retry-ar">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
  </div>
  
  <div id="mindar-container"></div>
  
  <div id="ui">
    <div id="top-bar">
      <button class="lang-btn" id="lang-toggle" aria-label="Switch language">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
      <button class="etsy-btn" id="etsy-link" aria-label="Visit our Etsy shop">Shop on Etsy</button>
    </div>
    
    <div id="info">Point your camera at any calendar marker ‚ù§Ô∏è</div>
    
    <div id="crystals"></div>
  </div>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  
  <!-- MindAR -->
  <script>
    function loadMindAR() {
      return new Promise((resolve, reject) => {
        if (typeof MindARThree !== 'undefined') {
          resolve();
          return;
        }

        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-three.prod.js';
        script.onload = () => resolve();
        script.onerror = () => reject(new Error('Failed to load MindAR'));
        document.head.appendChild(script);
      });
    }
  </script>

  <script>
    // Constants and versioning
    const DATA_VERSION = '2026-v1';
    const totalMonths = 12;

    // Month names for better UX
    const monthNames = {
      en: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
      uk: ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å']
    };

    // Cached geometries and materials for performance
    const CACHED_GEOMETRIES = {
      cube: new THREE.BoxGeometry(0.3, 0.3, 0.3),
      crystal: new THREE.OctahedronGeometry(0.3, 0),
      plane: new THREE.PlaneGeometry(0.4, 0.4)
    };

    // Main application
    class ARCalendar {
      constructor() {
        this.currentLang = 'en';
        this.collectedCrystals = [];
        this.activeCrystals = new Map();
        this.currentVisibleAnchor = -1;
        this.animationRunning = false;
        this.audioContext = null;
        
        this.loadData();
        this.init();
      }

      loadData() {
        try {
          const saved = JSON.parse(localStorage.getItem('ua-calendar-data') || '{}');
          if (saved.version === DATA_VERSION) {
            this.collectedCrystals = saved.crystals || [];
          } else {
            // Clear old data if version mismatch
            this.collectedCrystals = [];
            console.log('Cleared old data due to version mismatch');
          }
        } catch (error) {
          console.error('Error loading data:', error);
          this.collectedCrystals = [];
        }
      }

      saveData() {
        try {
          localStorage.setItem('ua-calendar-data', JSON.stringify({
            version: DATA_VERSION,
            crystals: this.collectedCrystals
          }));
        } catch (error) {
          console.error('Error saving data:', error);
        }
      }

      async init() {
        this.setupEventListeners();
        this.updateCrystalsUI();
        
        try {
          await loadMindAR();
          
          if (typeof MindARThree === 'undefined') {
            throw new Error('MindARThree not available');
          }

          console.log('‚úÖ All libraries loaded');
          this.initializeAR();
          
        } catch (error) {
          this.showError('‚ùå AR not supported in your browser');
          console.error('‚ùå Library loading failed:', error);
        }
      }

      setupEventListeners() {
        document.getElementById('lang-toggle').addEventListener('click', () => {
          this.setLang(this.currentLang === 'en' ? 'uk' : 'en');
        });
        
        document.getElementById('etsy-link').addEventListener('click', (e) => {
          e.preventDefault();
          this.openEtsyLink();
        });

        document.getElementById('retry-ar').addEventListener('click', () => {
          this.retryAR();
        });

        // Orientation change handling
        window.addEventListener('orientationchange', () => {
          setTimeout(() => {
            if (this.renderer) {
              const container = document.getElementById('mindar-container');
              this.renderer.setSize(container.clientWidth, container.clientHeight);
            }
          }, 300);
        });
      }

      setLang(lang) {
        this.currentLang = lang;
        localStorage.setItem('calendar-lang', lang);
        this.updateUI();
      }

      updateUI() {
        const t = this.translations[this.currentLang];
        document.getElementById('info').innerHTML = t.infoScan;
        document.getElementById('lang-toggle').textContent = t.langBtn;
        document.getElementById('lang-toggle').setAttribute('aria-label', this.currentLang === 'en' ? 'Switch to Ukrainian' : 'Switch to English');
        document.getElementById('etsy-link').textContent = t.etsyBtn;
        document.getElementById('loading-text').textContent = t.loading;
        this.updateCrystalsUI();
      }

      updateCrystalsUI() {
        const container = document.getElementById('crystals');
        container.innerHTML = '';
        for (let i = 0; i < totalMonths; i++) {
          const div = document.createElement('div');
          div.className = 'crystal-slot';
          div.setAttribute('aria-label', `${this.currentLang === 'en' ? 'Month' : '–ú—ñ—Å—è—Ü—å'} ${i + 1} ${this.collectedCrystals.includes(i) ? 'collected' : 'not collected'}`);
          
          if (this.collectedCrystals.includes(i)) {
            div.innerHTML = '‚ú¶';
            div.classList.add('collected');
          } else {
            div.innerHTML = (i + 1);
          }
          container.appendChild(div);
        }
      }

      openEtsyLink() {
        // Better approach for iOS Safari
        const link = document.createElement('a');
        link.href = 'https://smartlessa.etsy.com';
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      showTouchFeedback(x, y) {
        const feedback = document.createElement('div');
        feedback.className = 'touch-feedback';
        feedback.style.left = (x - 30) + 'px';
        feedback.style.top = (y - 30) + 'px';
        document.body.appendChild(feedback);
        
        setTimeout(() => {
          document.body.removeChild(feedback);
        }, 600);
      }

      playSound(frequency = 523.25, duration = 0.3) {
        try {
          if (!this.audioContext) {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
          }
          
          const oscillator = this.audioContext.createOscillator();
          const gainNode = this.audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(this.audioContext.destination);
          
          oscillator.frequency.value = frequency;
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
          
          oscillator.start(this.audioContext.currentTime);
          oscillator.stop(this.audioContext.currentTime + duration);
          
        } catch (error) {
          console.log('Audio not supported:', error);
        }
      }

      initializeAR() {
        const loadingEl = document.getElementById('loading');
        loadingEl.style.display = 'block';

        try {
          this.mindarThree = new MindARThree({
            container: document.getElementById("mindar-container"),
            imageTargetSrc: "calendar.mind",
            maxTrack: 1,
            uiScanning: "Looking for marker...",
            uiLoading: "Loading AR..."
          });

          const { renderer, scene, camera } = this.mindarThree;
          this.renderer = renderer;
          this.scene = scene;
          this.camera = camera;
          
          // Lighting
          const light = new THREE.DirectionalLight(0xffffff, 1);
          light.position.set(0, 1, 1);
          scene.add(light);
          scene.add(new THREE.AmbientLight(0xffffff, 0.5));

          // Create anchor groups with validation
          this.anchorGroups = [];
          for (let i = 0; i < totalMonths; i++) {
            try {
              const group = new THREE.Group();
              const anchor = this.mindarThree.addAnchor(i);
              if (!anchor) {
                console.warn(`‚ö†Ô∏è No anchor for month ${i}`);
                continue;
              }
              anchor.group.add(group);
              this.anchorGroups[i] = group;
            } catch (error) {
              console.warn(`‚ö†Ô∏è Failed to create anchor for month ${i}:`, error);
            }
          }

          // Global touch handler with feedback
          this.handleGlobalTouch = (e) => {
            e.preventDefault();
            
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            
            this.showTouchFeedback(clientX, clientY);
            
            if (this.currentVisibleAnchor === -1) return;
            if (!this.anchorGroups[this.currentVisibleAnchor]) return;
            
            this.handleMonthInteraction(this.currentVisibleAnchor);
          };

          // Add global event listeners once
          renderer.domElement.addEventListener('click', this.handleGlobalTouch);
          renderer.domElement.addEventListener('touchstart', this.handleGlobalTouch, { passive: false });

          // Start AR
          this.mindarThree.start().then(() => {
            console.log('‚úÖ AR started successfully');
            loadingEl.style.display = 'none';
            this.startAnimation();
            
          }).catch(error => {
            loadingEl.style.display = 'none';
            this.showError(this.translations[this.currentLang].errorCamera);
            console.error('‚ùå AR failed:', error);
          });

        } catch (error) {
          loadingEl.style.display = 'none';
          this.showError('‚ùå AR initialization failed');
          console.error('‚ùå AR setup error:', error);
        }
      }

      handleMonthInteraction(month) {
        if (this.collectedCrystals.includes(month)) {
          // Already collected - show gentle feedback
          this.playSound(392.00, 0.2); // Lower pitch for "already collected"
          this.showCrystalPulse(month);
          return;
        }

        // New collection
        this.playSound(523.25, 0.3); // Higher pitch for new collection
        this.showCrystal(month);
      }

      showCrystalPulse(month) {
        const arGroup = this.anchorGroups[month];
        if (!arGroup) return;

        // Create a quick pulse effect
        const pulseGeometry = new THREE.SphereGeometry(0.2, 16, 16);
        const pulseMaterial = new THREE.MeshBasicMaterial({
          color: 0xffff00,
          transparent: true,
          opacity: 0.6
        });
        
        const pulse = new THREE.Mesh(pulseGeometry, pulseMaterial);
        arGroup.add(pulse);

        // Animate pulse
        let scale = 1;
        const animatePulse = () => {
          scale += 0.1;
          pulse.scale.setScalar(scale);
          pulseMaterial.opacity -= 0.05;
          
          if (pulseMaterial.opacity > 0) {
            requestAnimationFrame(animatePulse);
          } else {
            arGroup.remove(pulse);
          }
        };
        animatePulse();
      }

      startAnimation() {
        if (this.animationRunning) return;
        
        this.animationRunning = true;
        let lastVisible = -1;

        const animate = () => {
          if (!this.animationRunning) return;

          this.renderer.render(this.scene, this.camera);
          
          // Check visible markers only if animation is running
          let currentVisible = -1;
          for (let i = 0; i < totalMonths; i++) {
            if (this.mindarThree.anchors[i] && this.mindarThree.anchors[i].visible) {
              currentVisible = i;
              break;
            }
          }

          if (currentVisible !== lastVisible) {
            // Clean up previous
            if (lastVisible !== -1 && this.anchorGroups[lastVisible]) {
              this.anchorGroups[lastVisible].clear();
            }
            
            // Setup new
            if (currentVisible !== -1 && this.anchorGroups[currentVisible]) {
              this.showMonthContent(currentVisible, this.anchorGroups[currentVisible]);
            }
            
            lastVisible = currentVisible;
            this.currentVisibleAnchor = currentVisible;
          }

          // Animate active crystals
          this.activeCrystals.forEach((crystal, month) => {
            if (crystal && crystal.rotation) {
              crystal.rotation.y += 0.02;
              crystal.rotation.x += 0.01;
            }
          });

          requestAnimationFrame(animate);
        };
        
        animate();
      }

      stopAnimation() {
        this.animationRunning = false;
      }

      showMonthContent(month, arGroup) {
        if (this.collectedCrystals.includes(month)) {
          this.showCrystal(month, arGroup);
          return;
        }

        arGroup.clear();
        this.activeCrystals.delete(month);

        // Colors for each month
        const colors = [0xff6b6b, 0x4ecdc4, 0x45b7d1, 0x96ceb4, 0xfeca57, 0xff9ff3, 
                       0x54a0ff, 0x5f27cd, 0x00d2d3, 0xff9f43, 0x10ac84, 0xee5a24];
        
        const material = new THREE.MeshBasicMaterial({ 
          color: colors[month % colors.length],
          transparent: true,
          opacity: 0.8
        });
        
        const cube = new THREE.Mesh(CACHED_GEOMETRIES.cube, material);
        arGroup.add(cube);

        // Add month name
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 512;
        canvas.height = 256;
        context.fillStyle = '#ffffff';
        context.font = 'bold 40px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText(monthNames[this.currentLang][month], 256, 128);
        
        const texture = new THREE.CanvasTexture(canvas);
        const textMaterial = new THREE.MeshBasicMaterial({ 
          map: texture,
          transparent: true
        });
        const textPlane = new THREE.Mesh(CACHED_GEOMETRIES.plane, textMaterial);
        textPlane.position.z = 0.2;
        arGroup.add(textPlane);
      }

      showCrystal(month, arGroup = this.anchorGroups[month]) {
        if (!arGroup) return;
        if (this.collectedCrystals.includes(month)) return;

        this.collectedCrystals.push(month);
        this.saveData();
        this.updateCrystalsUI();
        
        arGroup.clear();

        // Create crystal
        const material = new THREE.MeshBasicMaterial({
          color: 0x00ffff,
          transparent: true,
          opacity: 0.9
        });
        
        const crystal = new THREE.Mesh(CACHED_GEOMETRIES.crystal, material);
        arGroup.add(crystal);
        this.activeCrystals.set(month, crystal);

        // Check completion
        if (this.collectedCrystals.length === totalMonths) {
          setTimeout(() => {
            this.showCompletionCelebration();
          }, 1000);
        }
      }

      showCompletionCelebration() {
        document.getElementById('info').innerHTML = this.translations[this.currentLang].infoComplete;
        this.playSound(659.25, 1.0); // Celebration sound
        
        // Add some celebration particles
        if (this.currentVisibleAnchor !== -1 && this.anchorGroups[this.currentVisibleAnchor]) {
          const arGroup = this.anchorGroups[this.currentVisibleAnchor];
          const particleCount = 50;
          
          for (let i = 0; i < particleCount; i++) {
            const geometry = new THREE.SphereGeometry(0.05, 8, 8);
            const material = new THREE.MeshBasicMaterial({
              color: Math.random() > 0.5 ? 0x0057b7 : 0xffd700,
              transparent: true,
              opacity: 0.8
            });
            
            const particle = new THREE.Mesh(geometry, material);
            particle.position.set(
              (Math.random() - 0.5) * 2,
              (Math.random() - 0.5) * 2,
              (Math.random() - 0.5) * 2
            );
            
            particle.userData.velocity = new THREE.Vector3(
              (Math.random() - 0.5) * 0.02,
              (Math.random() - 0.5) * 0.02,
              (Math.random() - 0.5) * 0.02
            );
            
            arGroup.add(particle);
            
            // Animate particles
            setTimeout(() => {
              if (arGroup.children.includes(particle)) {
                arGroup.remove(particle);
              }
            }, 2000 + Math.random() * 1000);
          }
        }
      }

      showError(message) {
        document.getElementById('error-fallback').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
        console.error('Error:', message);
      }

      retryAR() {
        document.getElementById('error-fallback').style.display = 'none';
        this.cleanup();
        this.initializeAR();
      }

      cleanup() {
        if (this.renderer) {
          this.renderer.domElement.removeEventListener('click', this.handleGlobalTouch);
          this.renderer.domElement.removeEventListener('touchstart', this.handleGlobalTouch);
        }
        this.stopAnimation();
        this.activeCrystals.clear();
        
        if (this.mindarThree) {
          try {
            this.mindarThree.stop();
          } catch (error) {
            console.log('Error stopping MindAR:', error);
          }
        }
      }

      get translations() {
        return {
          en: {
            infoScan: "Point your camera at any calendar marker ‚ù§Ô∏è",
            infoComplete: "üéâ CONGRATULATIONS! All crystals collected!",
            langBtn: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",
            etsyBtn: "Shop on Etsy",
            loading: "Loading AR Experience...",
            errorCamera: "‚ùå Please allow camera access",
            errorLibrary: "‚ùå AR not supported"
          },
          uk: {
            infoScan: "–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –±—É–¥—å-—è–∫–∏–π –º–∞—Ä–∫–µ—Ä –∫–∞–ª–µ–Ω–¥–∞—Ä—è ‚ù§Ô∏è",
            infoComplete: "üéâ –í–Ü–¢–ê–Æ! –í—Å—ñ –∫—Ä–∏—Å—Ç–∞–ª–∏ –∑—ñ–±—Ä–∞–Ω—ñ!",
            langBtn: "English",
            etsyBtn: "–ö—É–ø–∏—Ç–∏ –Ω–∞ Etsy",
            loading: "–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ AR...",
            errorCamera: "‚ùå –î–æ–∑–≤–æ–ª—å –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏",
            errorLibrary: "‚ùå AR –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è"
          }
        };
      }
    }

    // Initialize app when ready
    let app;
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        app = new ARCalendar();
      });
    } else {
      app = new ARCalendar();
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (app) {
        app.cleanup();
      }
    });
  </script>
</body>
</html>
